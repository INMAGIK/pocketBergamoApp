
<ion-view title="{{appInfo.title}}">
  <!--  
  <ion-nav-buttons side="left">
    <button menu-toggle="left"class="button button-icon icon ion-navicon"></button>
  </ion-nav-buttons>
    -->

    
    <ion-header-bar  class="bar-positive">
        
        <button class="button icon ion-help" ng-click="toggleHelp()"></button>
        <h1 class="title">{{appInfo.title}}</h1>
        <button class="button icon ion-information-circled" ng-click="openModal()"></button>
    </ion-header-bar>
  
  <ion-content class="has-header" scroll="false" ng-cloak>
    
    
    <div id="loader-overlay" ng-if="uiStatus.dataLoaded==false">
      <h1 class="amatic-bold">
        Loading map data
      </h1>
      <br>
      <img src="img/loader.gif" alt="loader">
      

    </div>
    <div id="main-map" class="main-map"></div>

    <!-- help, move away! -->
    <div class="help" ng-controller="HelpCtrl" ng-if="helpShown==true" ng-class="{'with-backdrop' : step.backdrop }">
      <div class="overlay-light" ng-style="overlayStyle">
      </div>
      <div class="help-popup">
        <div class="bar bar-calm help-header ">
          <h4 class="help-title">{{ step.title }}</h4>  
          <div class="help-close">
            <button class="button icon ion-close-round button-small " ng-click="toggleHelp()"></button>
          </div>
        </div>
        <div class="help-content">
          <div ng-bind-html="step.text" ng-if="step.text"> </div>
          <div ng-include="step.template" ng-if="step.template"> </div>
        </div>
        <div class="help-footer">
          <div class="row">
            <div class="col">
              <button class="button button-energized button" ng-if="step.buttons.prev" ng-click="setStep(step.buttons.prev.step)">
                <i class="icon ion-arrow-left-a"></i>&nbsp;
                {{step.buttons.prev.label}}
              </button>
              
            </div>
            <div class="col">
              <button class="button button-positive button" ng-if="step.buttons.next" ng-click="setStep(step.buttons.next.step)">
                {{step.buttons.next.label}}&nbsp;
                <i class="icon ion-arrow-right-a"></i>
              </button>
            </div>
            
          </div>
          
        </div>
      </div>
    </div>
  

    
    <div class="toolbar">
        <button class="button button-small button-positive icon ion-android-locate" ng-click="toggleGeolocation()" ng-class="{'button-assertive' : uiStatus.gps == true }">
        </button>
        <button class="button button-small button-positive icon ion-navigate" ng-click="toggleFollow()" ng-class="{'button-assertive' : uiStatus.follow == true }" ng-disabled="uiStatus.gps == false || (!uiStatus.locationInExtent)">
        </button>
        <button class="button button-small button-positive icon ion-refresh" ng-click="toggleOrientation()" ng-class="{'button-assertive' : uiStatus.orientation == true }">
        </button>
        <button class="button button-small button-positive icon ion-arrow-up-c" ng-click="toggleLockRotation()" ng-class="{'button-assertive' : uiStatus.lockRotate == true }">
        </button>
    </div>

    <div class="bottom-toolbar">
        <button class="button button-small button-positive icon ion-map" ng-click="togglePanel('layers', true)" ng-class="{'button-assertive' : panels['layers'] == true }">
        </button>
        <button class="button button-small button-positive icon ion-navicon" ng-click="openBrowser()">
        </button>
        <button class="button button-small button-positive icon ion-search" ng-click="togglePanel('search', true)" ng-class="{'button-assertive' : panels['search'] == true }">
        </button>
      
    </div>

    <div class="layers-browser transparent-box aa" ng-if="panels.layers" >
      <div class="padding">
      <h4>Layers</h4>
          <div class="layer-switcher" map-id="main-map" groups="vectors" >
          </div>
      </div>
    </div>

    <!--move to directive -->
    <div class="search-panel transparent-box aa" ng-if="panels.search" ng-controller="SearchCtrl">
      
        <div class="padding transparent-box">
        <div class="list transparent-box">

          <div class="item-input transparent-box" >
          <label class="item-input-wrapper transparent-box">
            <input type="text" placeholder="Search text" ng-model="searchStatus.search">
          </label>
          <button class="button button-small button-calm" ng-click="search()" ng-disabled="searchStatus.search.length < 2 ">
            Search
          </button>
          </div>

          <div class="item item-checkbox transparent" style="margin:0px 10px;">
          <label class="checkbox">
            <input type="checkbox" ng-model="searchStatus.address">
          </label>
          Match addresses
        </div>

          <div class="item-input transparent-box transparent-box" ng-if="searchStatus.lastSearch" style="margin:0px 10px;">
            <b>{{  searchStatus.searchResults.length }}</b>&nbsp;results for&nbsp;<b>{{ searchStatus.lastSearch }}</b> &nbsp;
            <button class="button button-assertive button-small" ng-click="clear()">Clear</button>
          </div>

        </div>
        
        <div class="search-results" style="margin-top:-10px;">
          
        <div class="list transparent-box" style="margin:0 10px;">
          <div class="item item-button-right transparent" ng-repeat="result in searchStatus.searchResults">
            <img class="icon-title" src="{{ result.icon }}" alt="">
            {{ result.layerName }} - {{ result.title }}
            <div xng-if="searchStatus.address">
              <small>{{ result.feature.display_name }}</small>
            </div>
            <button class="button button-clear " ng-click="centerFeature(result.feature)">
              <i class="icon ion-android-location"></i>
            </button>
          </div>
        </div>
        </div>

      </div>
    </div>

    
    <!-- popover ... #TODO: move to a directive! -->
    <div class="popover hide" id="popup">
      <div class="popover-arrow"></div>
      <div class="popover-content"></div>
    </div>


    <!-- hud -->
    <!--
    <div class="hud" id="hud"></div>
    -->




      
    
      
    
  </ion-content>

</ion-view>
